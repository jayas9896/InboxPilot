<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InboxPilot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Newsreader:opsz,wght@6..72,400;6..72,600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0e1014;
        --surface: #171a21;
        --surface-alt: #222733;
        --accent: #ffb347;
        --accent-2: #4dd3ff;
        --text: #f3f4f6;
        --muted: #a2a6b3;
        --danger: #ff6b6b;
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Space Grotesk", sans-serif;
        background: radial-gradient(circle at top left, #1f2430, #0e1014 55%);
        color: var(--text);
      }

      .hero {
        padding: 48px 8vw 24px;
        display: grid;
        gap: 16px;
      }

      .hero h1 {
        font-family: "Newsreader", serif;
        font-size: clamp(2.4rem, 4vw, 3.6rem);
        margin: 0;
      }

      .hero p {
        margin: 0;
        color: var(--muted);
        max-width: 720px;
      }

      .grid {
        display: grid;
        gap: 20px;
        padding: 0 8vw 48px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }

      .card {
        background: linear-gradient(160deg, var(--surface), var(--surface-alt));
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25);
        display: grid;
        gap: 12px;
      }

      .card h2 {
        font-size: 1.1rem;
        margin: 0;
      }

      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      button {
        background: var(--accent);
        border: none;
        color: #141414;
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
      }

      button.secondary {
        background: transparent;
        border: 1px solid var(--accent-2);
        color: var(--accent-2);
      }

      input,
      textarea {
        width: 100%;
        border: 1px solid transparent;
        border-radius: 12px;
        padding: 10px 12px;
        background: #0f1218;
        color: var(--text);
      }

      textarea {
        min-height: 90px;
        resize: vertical;
      }

      .list {
        display: grid;
        gap: 8px;
        max-height: 220px;
        overflow: auto;
      }

      .list-item {
        padding: 10px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.05);
      }

      .status {
        font-size: 0.9rem;
        color: var(--muted);
      }

      .pill {
        display: inline-flex;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(77, 211, 255, 0.2);
        color: var(--accent-2);
        font-size: 0.75rem;
        font-weight: 600;
      }

      @media (max-width: 680px) {
        .hero {
          padding: 32px 6vw 16px;
        }

        .grid {
          padding: 0 6vw 32px;
        }
      }
    </style>
  </head>
  <body>
    <section class="hero">
      <span class="pill">Local-first dashboard</span>
      <h1>InboxPilot Command Center</h1>
      <p>
        Triage email and meetings, draft replies, and capture tasks without leaving your
        machine. Everything stays draft-first.
      </p>
      <div class="row">
        <input id="apiKey" placeholder="API key (optional)" />
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>Quick Ingest</h2>
        <div class="row">
          <button id="ingestEmails">Ingest Mock Emails</button>
          <button id="ingestGmail" class="secondary">Ingest Gmail</button>
          <button id="ingestOutlook" class="secondary">Ingest Outlook</button>
          <button id="ingestMeetings" class="secondary">Ingest Mock Meetings</button>
        </div>
        <div class="status" id="ingestStatus">Waiting for action.</div>
      </div>

      <div class="card">
        <h2>Messages</h2>
        <button id="loadMessages">Refresh Messages</button>
        <div class="list" id="messagesList"></div>
      </div>

      <div class="card">
        <h2>Search</h2>
        <input id="searchQuery" placeholder="Search messages..." />
        <button id="searchMessages">Search</button>
        <div class="list" id="searchList"></div>
      </div>

      <div class="card">
        <h2>Meetings</h2>
        <button id="loadMeetings">Refresh Meetings</button>
        <div class="list" id="meetingsList"></div>
      </div>

      <div class="card">
        <h2>Meeting Search</h2>
        <input id="meetingQuery" placeholder="Search meetings..." />
        <button id="searchMeetings">Search</button>
        <div class="list" id="meetingSearchList"></div>
      </div>

      <div class="card">
        <h2>Chat Assistant</h2>
        <input id="chatQuery" placeholder="Ask about your inbox..." />
        <button id="askChat">Ask</button>
        <div class="list" id="chatResponse"></div>
      </div>

      <div class="card">
        <h2>Draft Reply</h2>
        <input id="draftMessageId" placeholder="Message ID" />
        <textarea id="draftInstructions" placeholder="Draft instructions"></textarea>
        <button id="draftReply">Draft</button>
        <div class="list" id="draftResponse"></div>
      </div>

      <div class="card">
        <h2>Categories</h2>
        <input id="categoryName" placeholder="Category name" />
        <input id="categoryDescription" placeholder="Description (optional)" />
        <div class="row">
          <button id="createCategory">Create</button>
          <button id="loadCategories" class="secondary">Refresh</button>
        </div>
        <input id="suggestMessageId" placeholder="Message ID for suggestion" />
        <button id="suggestCategories">Suggest</button>
        <div class="list" id="categoriesList"></div>
      </div>

      <div class="card">
        <h2>Tasks</h2>
        <input id="taskMessageId" placeholder="Message ID" />
        <input id="taskDescription" placeholder="Task description" />
        <div class="row">
          <button id="addTask">Add Task</button>
          <button id="extractTasks" class="secondary">Extract Tasks</button>
        </div>
        <div class="list" id="tasksList"></div>
      </div>

      <div class="card">
        <h2>Connections</h2>
        <input id="connectionType" placeholder="Provider type (email/calendar)" />
        <input id="connectionName" placeholder="Provider name (gmail/outlook)" />
        <input id="connectionStatus" placeholder="Status (connected/pending)" />
        <input id="connectionDetails" placeholder="Details (optional)" />
        <div class="row">
          <button id="addConnection">Add Connection</button>
          <button id="loadConnections" class="secondary">Refresh</button>
        </div>
        <div class="list" id="connectionsList"></div>
      </div>

      <div class="card">
        <h2>Stats</h2>
        <button id="loadStats">Refresh Stats</button>
        <div class="list" id="statsList"></div>
      </div>

      <div class="card">
        <h2>Triage</h2>
        <button id="loadTriage">Refresh Triage</button>
        <div class="list" id="triageList"></div>
      </div>

      <div class="card">
        <h2>OAuth Links</h2>
        <div class="row">
          <button id="googleOauth">Google OAuth</button>
          <button id="microsoftOauth" class="secondary">Microsoft OAuth</button>
        </div>
        <div class="list" id="oauthList"></div>
      </div>
    </section>

    <script>
      const api = "";
      const apiKeyInput = document.getElementById("apiKey");

      const authHeaders = () => {
        const key = apiKeyInput ? apiKeyInput.value.trim() : "";
        return key ? { "X-API-Key": key } : {};
      };

      const setStatus = (text) => {
        document.getElementById("ingestStatus").textContent = text;
      };

      const renderList = (el, items, render) => {
        el.innerHTML = "";
        if (!items || items.length === 0) {
          el.innerHTML = "<div class='status'>No data yet.</div>";
          return;
        }
        items.forEach((item) => {
          const div = document.createElement("div");
          div.className = "list-item";
          div.textContent = render(item);
          el.appendChild(div);
        });
      };

      document.getElementById("ingestEmails").addEventListener("click", async () => {
        setStatus("Ingesting mock emails...");
        const response = await fetch(`${api}/ingest/mock`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ limit: 5 }),
        });
        const payload = await response.json();
        setStatus(`Ingested ${payload.ingested} emails.`);
      });


      document.getElementById("ingestGmail").addEventListener("click", async () => {
        setStatus("Ingesting Gmail messages...");
        const response = await fetch(`${api}/ingest/gmail`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ limit: 5 }),
        });
        const payload = await response.json();
        if (response.ok) {
          setStatus(`Ingested ${payload.ingested} Gmail messages.`);
        } else {
          setStatus(payload.detail || "Gmail ingestion failed.");
        }
      });


      document.getElementById("ingestOutlook").addEventListener("click", async () => {
        setStatus("Ingesting Outlook messages...");
        const response = await fetch(`${api}/ingest/outlook`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ limit: 5 }),
        });
        const payload = await response.json();
        if (response.ok) {
          setStatus(`Ingested ${payload.ingested} Outlook messages.`);
        } else {
          setStatus(payload.detail || "Outlook ingestion failed.");
        }
      });

      document.getElementById("ingestMeetings").addEventListener("click", async () => {
        setStatus("Ingesting mock meetings...");
        const response = await fetch(`${api}/ingest/calendar-mock`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ limit: 5 }),
        });
        const payload = await response.json();
        setStatus(`Ingested ${payload.ingested} meetings.`);
      });

      document.getElementById("loadMessages").addEventListener("click", async () => {
        const response = await fetch(`${api}/messages`, { headers: authHeaders() });
        const payload = await response.json();
        renderList(document.getElementById("messagesList"), payload, (item) => {
          return `#${item.id} ${item.subject} (${item.sender})`;
        });
      });

      document.getElementById("searchMessages").addEventListener("click", async () => {
        const query = document.getElementById("searchQuery").value;
        const response = await fetch(`${api}/messages/search?query=${encodeURIComponent(query)}`, {
          headers: authHeaders(),
        });
        const payload = await response.json();
        renderList(document.getElementById("searchList"), payload, (item) => {
          return `#${item.id} ${item.subject} (${item.sender})`;
        });
      });

      document.getElementById("loadMeetings").addEventListener("click", async () => {
        const response = await fetch(`${api}/meetings`, { headers: authHeaders() });
        const payload = await response.json();
        renderList(document.getElementById("meetingsList"), payload, (item) => {
          return `#${item.id} ${item.title}`;
        });
      });

      document.getElementById("searchMeetings").addEventListener("click", async () => {
        const query = document.getElementById("meetingQuery").value;
        const response = await fetch(
          `${api}/meetings/search?query=${encodeURIComponent(query)}`,
          { headers: authHeaders() }
        );
        const payload = await response.json();
        renderList(document.getElementById("meetingSearchList"), payload, (item) => {
          return `#${item.id} ${item.title}`;
        });
      });

      document.getElementById("askChat").addEventListener("click", async () => {
        const query = document.getElementById("chatQuery").value;
        const response = await fetch(`${api}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ query }),
        });
        const payload = await response.json();
        renderList(document.getElementById("chatResponse"), [payload], (item) => item.answer);
      });

      document.getElementById("draftReply").addEventListener("click", async () => {
        const messageId = Number(document.getElementById("draftMessageId").value || 0);
        const instructions = document.getElementById("draftInstructions").value;
        const response = await fetch(`${api}/draft`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ message_id: messageId, instructions }),
        });
        const payload = await response.json();
        renderList(document.getElementById("draftResponse"), [payload], (item) => item.draft);
      });

      document.getElementById("createCategory").addEventListener("click", async () => {
        const name = document.getElementById("categoryName").value;
        const description = document.getElementById("categoryDescription").value || null;
        await fetch(`${api}/categories`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ name, description }),
        });
        document.getElementById("categoryName").value = "";
        document.getElementById("categoryDescription").value = "";
      });

      document.getElementById("loadCategories").addEventListener("click", async () => {
        const response = await fetch(`${api}/categories`, { headers: authHeaders() });
        const payload = await response.json();
        renderList(document.getElementById("categoriesList"), payload, (item) => {
          return `${item.name} ${item.description ? `- ${item.description}` : ""}`;
        });
      });

      document.getElementById("suggestCategories").addEventListener("click", async () => {
        const messageId = Number(document.getElementById("suggestMessageId").value || 0);
        const response = await fetch(`${api}/categories/suggest`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ message_id: messageId }),
        });
        const payload = await response.json();
        renderList(document.getElementById("categoriesList"), payload, (item) => {
          return `${item.name} ${item.description ? `- ${item.description}` : ""}`;
        });
      });

      document.getElementById("addTask").addEventListener("click", async () => {
        const messageId = Number(document.getElementById("taskMessageId").value || 0);
        const description = document.getElementById("taskDescription").value;
        await fetch(`${api}/tasks`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ parent_type: "message", parent_id: messageId, description }),
        });
        document.getElementById("taskDescription").value = "";
      });

      document.getElementById("extractTasks").addEventListener("click", async () => {
        const messageId = Number(document.getElementById("taskMessageId").value || 0);
        await fetch(`${api}/tasks/extract`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({ message_id: messageId }),
        });
      });

      document.getElementById("addConnection").addEventListener("click", async () => {
        const providerType = document.getElementById("connectionType").value;
        const providerName = document.getElementById("connectionName").value;
        const status = document.getElementById("connectionStatus").value;
        const details = document.getElementById("connectionDetails").value || null;
        await fetch(`${api}/connections`, {
          method: "POST",
          headers: { "Content-Type": "application/json", ...authHeaders() },
          body: JSON.stringify({
            provider_type: providerType,
            provider_name: providerName,
            status,
            details,
          }),
        });
      });

      document.getElementById("loadConnections").addEventListener("click", async () => {
        const response = await fetch(`${api}/connections`, { headers: authHeaders() });
        const payload = await response.json();
        renderList(document.getElementById("connectionsList"), payload, (item) => {
          return `${item.provider_type}/${item.provider_name} - ${item.status}`;
        });
      });

      document.getElementById("loadStats").addEventListener("click", async () => {
        const response = await fetch(`${api}/stats`, { headers: authHeaders() });
        const payload = await response.json();
        const items = Object.entries(payload).map(([key, value]) => ({ key, value }));
        renderList(document.getElementById("statsList"), items, (item) => {
          return `${item.key}: ${item.value}`;
        });
      });

      document.getElementById("loadTriage").addEventListener("click", async () => {
        const response = await fetch(`${api}/triage`, { headers: authHeaders() });
        const payload = await response.json();
        renderList(document.getElementById("triageList"), payload, (item) => {
          return `${item.priority}: #${item.id} ${item.subject}`;
        });
      });

      const renderOauth = (payload) => {
        renderList(document.getElementById("oauthList"), [payload], (item) => {
          return `${item.url}`;
        });
      };

      document.getElementById("googleOauth").addEventListener("click", async () => {
        const response = await fetch(`${api}/oauth/google`, { headers: authHeaders() });
        const payload = await response.json();
        renderOauth(payload);
      });

      document.getElementById("microsoftOauth").addEventListener("click", async () => {
        const response = await fetch(`${api}/oauth/microsoft`, { headers: authHeaders() });
        const payload = await response.json();
        renderOauth(payload);
      });
    </script>
  </body>
</html>
